<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Netlify App - CORS Proxy Test</title>
    <link href="style.css" rel="stylesheet">
    <script type="text/javascript" src="angular-core.js"></script>
  </head>
  <body>
   <div style="padding: 20px; font-family: Arial, sans-serif;">
     <h1>–¢–µ—Å—Ç CORS –ü—Ä–æ–∫—Å–∏</h1>
     
     <button class="style interact-button" onclick="testProxy()">üîç –¢–µ—Å—Ç –ø—Ä–æ–∫—Å–∏</button>
     <button class="style interact-button" onclick="testBinanceAPI()">üí∞ –¢–µ—Å—Ç Binance API</button>
     <button class="style interact-button" onclick="testBSCRPC()">‚õìÔ∏è –¢–µ—Å—Ç BSC RPC</button>
     <button class="style interact-button" onclick="clearStatus()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
     
     <div id="status" style="margin-top: 20px; padding: 15px; background: #f5f5f5; border-radius: 5px; white-space: pre-wrap; font-family: monospace;"></div>
   </div>
   
   <script>
   // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ —Å—Ç–∞—Ç—É—Å
   function log(message, type = 'info') {
     const statusDiv = document.getElementById('status');
     const timestamp = new Date().toLocaleTimeString();
     const icon = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
     statusDiv.innerHTML += `[${timestamp}] ${icon} ${message}\n`;
     statusDiv.scrollTop = statusDiv.scrollHeight;
   }
   
   // –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
   function clearStatus() {
     document.getElementById('status').innerHTML = '';
   }
   
   // –¢–µ—Å—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø—Ä–æ–∫—Å–∏
   async function testProxy() {
     log('–ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç –ø—Ä–æ–∫—Å–∏...', 'info');
     
     try {
       // –¢–µ—Å—Ç Netlify Function
       log('–ü—Ä–æ–≤–µ—Ä—è–µ–º Netlify Function...', 'info');
       const netlifyResponse = await fetch('/.netlify/functions/secureproxy?e=ping_proxy');
       
       if (netlifyResponse.ok) {
         const netlifyResult = await netlifyResponse.text();
         if (netlifyResult === 'pong') {
           log('Netlify Function –ø—Ä–æ–∫—Å–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç!', 'success');
         } else {
           log('Netlify Function –≤–µ—Ä–Ω—É–ª –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ' + netlifyResult, 'warning');
         }
       } else {
         log('Netlify Function –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ' + netlifyResponse.status, 'error');
       }
       
       // –¢–µ—Å—Ç –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ –ø—É—Ç–∏
       log('–ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø—É—Ç—å...', 'info');
       const altResponse = await fetch('/secureproxy?e=ping_proxy');
       
       if (altResponse.ok) {
         const altResult = await altResponse.text();
         if (altResult === 'pong') {
           log('–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø—É—Ç—å –ø—Ä–æ–∫—Å–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç!', 'success');
         } else {
           log('–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø—É—Ç—å –≤–µ—Ä–Ω—É–ª –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ' + altResult, 'warning');
         }
       } else {
         log('–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø—É—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ' + altResponse.status, 'error');
       }
       
     } catch (error) {
       log('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø—Ä–æ–∫—Å–∏: ' + error.message, 'error');
     }
   }
   
   // –¢–µ—Å—Ç Binance API
   async function testBinanceAPI() {
     log('–¢–µ—Å—Ç–∏—Ä—É–µ–º Binance API...', 'info');
     
     const endpoints = [
       'api/v3/ping',
       'api/v3/time',
       'api/v3/ticker/price?symbol=BTCUSDT'
     ];
     
     for (const endpoint of endpoints) {
       try {
         log(`–ü—Ä–æ–≤–µ—Ä—è–µ–º ${endpoint}...`, 'info');
         
         const response = await fetch('/.netlify/functions/secureproxy?e=' + encodeURIComponent(endpoint), {
           method: 'GET',
           headers: {
             'Content-Type': 'application/json'
           }
         });
         
         if (response.ok) {
           const data = await response.json();
           log(`${endpoint} - –£—Å–ø–µ—Ö: ${JSON.stringify(data).substring(0, 100)}...`, 'success');
         } else {
           log(`${endpoint} - –û—à–∏–±–∫–∞: ${response.status} ${response.statusText}`, 'error');
         }
         
       } catch (error) {
         log(`${endpoint} - –ò—Å–∫–ª—é—á–µ–Ω–∏–µ: ${error.message}`, 'error');
       }
     }
   }
   
   // –¢–µ—Å—Ç BSC RPC
   async function testBSCRPC() {
     log('–¢–µ—Å—Ç–∏—Ä—É–µ–º BSC RPC...', 'info');
     
     const rpcCalls = [
       {
         name: 'eth_blockNumber',
         method: 'eth_blockNumber',
         params: []
       },
       {
         name: 'eth_gasPrice',
         method: 'eth_gasPrice',
         params: []
       },
       {
         name: 'net_version',
         method: 'net_version',
         params: []
       }
     ];
     
     for (const call of rpcCalls) {
       try {
         log(`–ü—Ä–æ–≤–µ—Ä—è–µ–º ${call.name}...`, 'info');
         
         const response = await fetch('/.netlify/functions/secureproxy?e=', {
           method: 'POST',
           headers: {
             'Content-Type': 'application/json'
           },
           body: JSON.stringify({
             jsonrpc: '2.0',
             id: 1,
             method: call.method,
             params: call.params
           })
         });
         
         if (response.ok) {
           const data = await response.json();
           if (data.result) {
             log(`${call.name} - –£—Å–ø–µ—Ö: ${data.result}`, 'success');
           } else if (data.error) {
             log(`${call.name} - RPC –û—à–∏–±–∫–∞: ${data.error.message}`, 'error');
           } else {
             log(`${call.name} - –ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç: ${JSON.stringify(data)}`, 'warning');
           }
         } else {
           log(`${call.name} - HTTP –û—à–∏–±–∫–∞: ${response.status} ${response.statusText}`, 'error');
         }
         
       } catch (error) {
         log(`${call.name} - –ò—Å–∫–ª—é—á–µ–Ω–∏–µ: ${error.message}`, 'error');
       }
     }
   }
   
   // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–∑–æ–≤–∞ API —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏
   async function callAPI(endpoint, method = 'GET', data = null, useAltPath = false) {
     const baseUrl = useAltPath ? '/secureproxy' : '/.netlify/functions/secureproxy';
     const url = baseUrl + '?e=' + encodeURIComponent(endpoint);
     
     const options = {
       method: method,
       headers: {
         'Content-Type': 'application/json'
       }
     };
     
     if (data && method !== 'GET') {
       options.body = JSON.stringify(data);
     }
     
     try {
       const response = await fetch(url, options);
       
       if (!response.ok) {
         throw new Error(`HTTP ${response.status}: ${response.statusText}`);
       }
       
       return await response.json();
     } catch (error) {
       console.error('–û—à–∏–±–∫–∞ API:', error);
       throw error;
     }
   }
   
   // –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
   async function getBinancePrice(symbol) {
     try {
       const data = await callAPI(`api/v3/ticker/price?symbol=${symbol}`);
       return data;
     } catch (error) {
       console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ü–µ–Ω—ã:', error);
       return null;
     }
   }
   
   async function getBSCBlockNumber() {
     try {
       const data = await callAPI('', 'POST', {
         jsonrpc: '2.0',
         id: 1,
         method: 'eth_blockNumber',
         params: []
       });
       return data;
     } catch (error) {
       console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–º–µ—Ä–∞ –±–ª–æ–∫–∞:', error);
       return null;
     }
   }
   
   // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
   window.addEventListener('load', function() {
     log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –ø—Ä–æ–∫—Å–∏.', 'info');
     log('–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –≤—ã—à–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö API.', 'info');
   });
   
   // –≠–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
   window.testProxy = testProxy;
   window.testBinanceAPI = testBinanceAPI;
   window.testBSCRPC = testBSCRPC;
   window.callAPI = callAPI;
   window.getBinancePrice = getBinancePrice;
   window.getBSCBlockNumber = getBSCBlockNumber;
   </script>
  </body>
</html>